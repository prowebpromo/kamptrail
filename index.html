<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>KampTrail ‚Äî Free Campsite Map</title>
  <meta name="description" content="Find free and low-cost campsites across the US with advanced filters, overlays, and trip planning.">
  <meta name="theme-color" content="#0b141b">

  <!-- PWA / A2HS -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="application-name" content="KampTrail">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">
  <meta name="color-scheme" content="light dark">

  <!-- Social -->
  <meta property="og:title" content="KampTrail ‚Äî Free Campsite Map">
  <meta property="og:type" content="website">
  <meta property="og:image" content="og.png">
  <meta property="og:description" content="Fast, offline-first campsite map with overlays, filters, and trip planning.">
  <meta property="og:url" content="https://prowebpromo.github.io/kamptrail/">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Networking hint -->
  <link rel="preconnect" href="https://tile.openstreetmap.org">

  <!-- Leaflet core -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css">
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

  <!-- Overlays UI styles -->
  <link rel="stylesheet" href="overlays/overlays.css">

  <style>
    :root{--c-bg:#0b141b;--c-panel:#0f1b24;--c-border:#22313f;--c-accent:#86b7ff;--c-text:#e8f0f7;--c-sub:#9fd0ff;}
    html,body{height:100%;margin:0;background:var(--c-bg);color:var(--c-text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    #app{display:grid;grid-template-rows:auto 1fr auto;height:100%}
    header{position:sticky;top:0;z-index:1000;display:flex;gap:10px;align-items:center;padding:10px 12px;background:var(--c-panel);border-bottom:1px solid var(--c-border)}
    header h1{margin:0;font-size:16px;font-weight:700}
    .actions{margin-left:auto;display:flex;gap:8px}
    .btn{border:1px solid var(--c-border);background:#15232e;color:#cfe3f2;padding:6px 12px;border-radius:10px;cursor:pointer;font-size:13px}
    .btn:hover{background:#1f3d52;border-color:#284356}
    .btn.active{background:#173243;border-color:var(--c-accent);color:var(--c-sub)}
    #map{height:calc(100vh - 92px)}
    footer{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--c-panel);border-top:1px solid var(--c-border);font-size:12px;color:#b7c7d6}
    footer a{color:var(--c-sub);text-decoration:none}
    footer a:hover{text-decoration:underline}
    .toast{position:fixed;left:50%;bottom:70px;transform:translateX(-50%);display:none;z-index:2000;background:#173243;border:1px solid #284356;border-radius:12px;padding:12px 16px;max-width:90vw;box-shadow:0 4px 12px rgba(0,0,0,.3)}
    .toast.show{display:block}
    .loading{position:fixed;inset:auto 0 0 0;top:0;display:none;place-items:center;background:rgba(11,20,27,.35);z-index:1900}
    .loading.show{display:grid}
    .spinner{border:3px solid #284356;border-top:3px solid var(--c-accent);border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div id="app">
    <header>
      <h1>üèïÔ∏è KampTrail</h1>
      <input id="search" type="search" placeholder="Search campsites..." aria-label="Search campsites" style="flex:1;max-width:300px;padding:6px 12px;border:1px solid var(--c-border);background:#0b141b;color:var(--c-text);border-radius:10px;font-size:13px;">
      <div class="actions">
        <button id="filters" class="btn" aria-label="Open filters">üîç Filters</button>
        <button id="trip" class="btn" aria-label="Open trip planner">üß≠ My Trip <span id="trip-count">(0)</span></button>
        <button id="near" class="btn" aria-label="Find campsites near me" aria-pressed="false">üìç Near me</button>
      </div>
    </header>

    <div id="map" role="region" aria-label="Campsite map" tabindex="0"></div>

    <footer>
      <div>
        Map ¬© <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap</a> contributors
      </div>
      <div>
        <a href="https://github.com/prowebpromo/kamptrail" target="_blank" rel="noopener">Open Source</a>
      </div>
    </footer>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <div id="loading" class="loading"><div class="spinner"></div></div>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').catch(console.error);
      });
    }

    function showToast(msg){
      const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'), 3000);
    }
    function setLoading(on){document.getElementById('loading').classList.toggle('show', !!on)}

    const map = L.map('map').setView([39.8283, -98.5795], 5);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{
      maxZoom:19, attribution:'&copy; OpenStreetMap contributors'
    }).addTo(map);

    document.getElementById('near').addEventListener('click', function(){
      navigator.geolocation.getCurrentPosition(
        pos => map.setView([pos.coords.latitude, pos.coords.longitude], 13),
        () => showToast('Could not get your location')
      );
    });
  </script>

  <script src="overlays/overlays.js"></script>
  <script src="data-loader.js"></script>
  <script src="filters.js"></script>
  <script src="trip-planner.js"></script>

  <script>
    (async () => {
      setLoading(true);
      await KampTrailData.init(map, {
        onTripAdd: (id) => window.KampTrailTrip && KampTrailTrip.addStop(id)
      });
      KampTrailFilters.init(map);
      KampTrailTrip.init(map);
      KampTrailOverlays.init(map, {});
      setLoading(false);
    })();
  </script>
</body>
</html>
